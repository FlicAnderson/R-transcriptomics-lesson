---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 02-starting-with-data.md in _episodes_rmd/
title: "Starting with data"
author: "Data Carpentry contributors"
minutes: 20
---



------------

> ### Learning Objectives
>
> * Load external data from a .csv file into a data frame.
> * Describe what a data frame is.
> * Summarize the contents of a data frame.
> * Use indexing to subset specific portions of data frames. 


------------

## Our biological question: do our favourite genes change expression in this dataset?

This workshop is based around a common situation in transcriptomics. We are interested in a group of genes, and another study has measured expression in  conditions where expression these genes might be interesting. Can we tell if our favourite genes have changing expression?

Here the dataset is of cell cycle progression in the yeast *Saccharomyces cerevisiae*, from this paper: Translational control of lipogenic enzymes in the cell cycle of synchronous, growing yeast cells. Blank et al 2017 https://doi.org/10.15252/embj.201695050.

In figure 2, the paper notes that ribosome biogenesis genes are periodically expressed during the cell cycle, but doesn't tell us which ones. **Can we find if our favourite gene is indeed periodically expressed?** So our data analysis goals are:

* Find which ribosome biogenesis genes are on the list in figure 2
* Plot the individual trajectories of favourites: NOP56, ACT1
* Recreate figure 2 so we can read the gene names.

# Data Manipulation using **tidyverse**

Packages in R are basically sets of additional functions that let you do more
stuff. The functions we've been using so far, like `str()`,
come built into R; packages give you access to more of them. Before you use a
package for the first time you need to install it on your machine, and then you
should import it in every subsequent R session when you need it. You should
already have installed the **`tidyverse`** package. This is an
"umbrella-package" that installs several packages useful for data analysis which
work together well such as **`readr`**, **`tidyr`**, **`dplyr`**, **`ggplot2`**, **`tibble`**, etc.


The **`tidyverse`** package tries to address 3 common issues that arise when
doing data analysis with some of the functions that come with R:

1. The results from a base R function sometimes depend on the type of data.
2. Using R expressions in a non standard way, which can be confusing for new
   learners.
3. Hidden arguments, having default operations that new learners are not aware
   of.



To load the package type:



~~~
## load the tidyverse packages, incl. dplyr
library("tidyverse")
~~~
{: .language-r}

## What are **`readr`**, **`dplyr`** and **`tidyr`**?


We'll read in our data using `read_lines()` and `read_tsv()` functions, from the tidyverse package 
The package **`readr`**.

The package **`dplyr`** provides easy tools for the most common data manipulation
tasks. It is built to work directly with data frames, with many common tasks
optimized by being written in a compiled language (C++). An additional feature is the
ability to work directly with data stored in an external database. The benefits of
doing this are that the data can be managed natively in a relational database,
queries can be conducted on that database, and only the results of the query are
returned.

This addresses a common problem with R in that all operations are conducted
in-memory and thus the amount of data you can work with is limited by available
memory. The database connections essentially remove that limitation in that you
can connect to a database of many hundreds of GB, conduct queries on it directly, and pull
back into R only what you need for analysis.

The package **`tidyr`** addresses the common problem of wanting to reshape your data for plotting and use by different R functions. Sometimes we want data sets where we have one row per measurement. Sometimes we want a data frame where each measurement type has its own column, and rows are instead more aggregated groups - like plots or aquaria. Moving back and forth between these formats is nontrivial, and **`tidyr`** gives you tools for this and more sophisticated  data manipulation.

To learn more about **`dplyr`** and **`tidyr`** after the workshop, you may want to check out this
[handy data transformation with **`dplyr`** cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf) and this [one about **`tidyr`**](https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf).




## Which ribosome biogenesis genes are in the list?

We need the list from figure 2 of the paper, and a list of ribosomal biogenesis (ribi) genes.

### List of genes from figure 2 in the paper

The paper says:

    * We then used the log2-transformations of these ratio values as input (see Fig 2 and Dataset 1 within the Source Data for this figure; also deposited in GEO:GSE81932).
    * Heatmap of the mRNA levels of the 144 genes (Dataset 2 within the Source Data for this figure) in common between the “Spellman Elu” and “This study” datasets.

This tells us that there are two sources for the data, one at the journal website and the other at NCBI's Gene Expression Omnibus. We can now search GEO:GSE81932, and see the website: https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE81932.

And at the bottom, there is GSE81932_Dataset02.txt.gz. Let's download that, using a function called `read_lines()`.


~~~
## Ask for help on read_lines
?read_lines
~~~
{: .language-r}

The help tells us about an `n_max` argument that controls how many lines we read. This is useful to inspect a file to see what it looks like before getting started. These functions can read data directly from online URLs, and automatically deal with compressed .gz files, which is very useful.

It will be easier if we make the file location an object rather than having to type it repeatedly. So let's read the first few lines of the file to check what it contains:


~~~
## Ask for help on read_lines
periodic_list_file <- "ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE81nnn/GSE81932/suppl/GSE81932_Dataset02.txt.gz"

read_lines(periodic_list_file,n_max=10)
~~~
{: .language-r}



~~~
 [1] "YBL027W" "YBL032W" "YBR206W" "YBR234C" "YCL054W" "YCL059C" "YCR034W"
 [8] "YCR073C" "YCR087W" "YDL031W"
~~~
{: .output}


The output looks like a character vector containing gene names, which is what we want, so let's load that into an object in our workspace.


~~~
periodic_list <- read_lines(periodic_list_file)
~~~
{: .language-r}

Now we have the list of genes.


> ## Challenge:
>
> 1. How many genes are on the list?
> 2. Can you see the last genes in the list?
>
> > ## Solution
> >
> > 
> > ~~~
> > [1] 144
> > ~~~
> > {: .output}
> > 
> > 
> > 
> > ~~~
> > [1] "YPR001W" "YPR031W" "YPR044C" "YPR050C" "YPR142C" "YPR143W"
> > ~~~
> > {: .output}
> {: .solution}
{: .challenge}


### List of ribosomal biogenesis (ribi) genes.

For this lesson, we will use the list of yeast ribi genes from https://www.yeastgenome.org/go/GO:0042254

Go to the *bottom* of the page for the longer computational list, click download and place the file in your `data` directory. You'll need to have a folder on your machine called "data" where you'll download the file. Take a look at it.



~~~
ribi_annotation_file <- "data/ribosome_biogenesis_annotations.txt"

read_lines(ribi_annotation_file,n_max=10)
~~~
{: .language-r}



~~~
 [1] "!"                                                                                                                                                               
 [2] "!Date: 04/23/2019"                                                                                                                                               
 [3] "!From: Saccharomyces Genome Database (SGD) "                                                                                                                     
 [4] "!URL: http://www.yeastgenome.org/ "                                                                                                                              
 [5] "!Contact Email: sgd-helpdesk@lists.stanford.edu "                                                                                                                
 [6] "!Funding: NHGRI at US NIH, grant number 5-U41-HG001315 "                                                                                                         
 [7] "!"                                                                                                                                                               
 [8] ""                                                                                                                                                                
 [9] "Gene\tGene Systematic Name\tQualifier\tGene Ontology Term ID\tGene Ontology Term\tAspect\tAnnotation Extension\tEvidence\tMethod\tSource\tAssigned On\tReference"
[10] "ECM1\tYAL059W\tribosome biogenesis\tGO:0042254\t\tbiological process\tIEA with KW-0690\tcomputational\tUniProt\t2019-04-20\t\tUniProt-GOA (2011)"                
~~~
{: .output}

What does this tell us about the file?  It is a text file, the first few lines start with a `!` character, and afterwards the tab-delimited table starts with tabs encoded as `\t`.

We are going to use the tidyverse function `read_tsv()` to read the contents of this file into R as a tibble (nice data frame) object. Inside the `read_tsv()` command, the first entry is a character string with the file name ("data/ribosome_biogenesis_annotations.txt")

We can remove the unwanted lines in two ways. We can either skip them:


~~~
read_tsv(ribi_annotation_file,skip=7)
~~~
{: .language-r}



~~~
Parsed with column specification:
cols(
  Gene = col_character(),
  `Gene Systematic Name` = col_character(),
  Qualifier = col_character(),
  `Gene Ontology Term ID` = col_character(),
  `Gene Ontology Term` = col_logical(),
  Aspect = col_character(),
  `Annotation Extension` = col_character(),
  Evidence = col_character(),
  Method = col_character(),
  Source = col_date(format = ""),
  `Assigned On` = col_logical(),
  Reference = col_character()
)
~~~
{: .output}



~~~
# A tibble: 218 x 12
   Gene  `Gene Systemati… Qualifier `Gene Ontology … `Gene Ontology …
   <chr> <chr>            <chr>     <chr>            <lgl>           
 1 ECM1  YAL059W          ribosome… GO:0042254       NA              
 2 UTP20 YBL004W          ribosome… GO:0042254       NA              
 3 MAK5  YBR142W          ribosome… GO:0042254       NA              
 4 RPB5  YBR154C          ribosome… GO:0042254       NA              
 5 RPS6B YBR181C          ribosome… GO:0042254       NA              
 6 RPS9B YBR189W          ribosome… GO:0042254       NA              
 7 ENP1  YBR247C          ribosome… GO:0042254       NA              
 8 REI1  YBR267W          ribosome… GO:0042254       NA              
 9 RRP7  YCL031C          ribosome… GO:0042254       NA              
10 SPB1  YCL054W          ribosome… GO:0042254       NA              
# ... with 208 more rows, and 7 more variables: Aspect <chr>, `Annotation
#   Extension` <chr>, Evidence <chr>, Method <chr>, Source <date>,
#   `Assigned On` <lgl>, Reference <chr>
~~~
{: .output}

Or we can tell R that the `!` is a comment character, and lines after that should be ignored.


~~~
read_tsv(ribi_annotation_file,comment="!")
~~~
{: .language-r}



~~~
Parsed with column specification:
cols(
  Gene = col_character(),
  `Gene Systematic Name` = col_character(),
  Qualifier = col_character(),
  `Gene Ontology Term ID` = col_character(),
  `Gene Ontology Term` = col_logical(),
  Aspect = col_character(),
  `Annotation Extension` = col_character(),
  Evidence = col_character(),
  Method = col_character(),
  Source = col_date(format = ""),
  `Assigned On` = col_logical(),
  Reference = col_character()
)
~~~
{: .output}



~~~
# A tibble: 218 x 12
   Gene  `Gene Systemati… Qualifier `Gene Ontology … `Gene Ontology …
   <chr> <chr>            <chr>     <chr>            <lgl>           
 1 ECM1  YAL059W          ribosome… GO:0042254       NA              
 2 UTP20 YBL004W          ribosome… GO:0042254       NA              
 3 MAK5  YBR142W          ribosome… GO:0042254       NA              
 4 RPB5  YBR154C          ribosome… GO:0042254       NA              
 5 RPS6B YBR181C          ribosome… GO:0042254       NA              
 6 RPS9B YBR189W          ribosome… GO:0042254       NA              
 7 ENP1  YBR247C          ribosome… GO:0042254       NA              
 8 REI1  YBR267W          ribosome… GO:0042254       NA              
 9 RRP7  YCL031C          ribosome… GO:0042254       NA              
10 SPB1  YCL054W          ribosome… GO:0042254       NA              
# ... with 208 more rows, and 7 more variables: Aspect <chr>, `Annotation
#   Extension` <chr>, Evidence <chr>, Method <chr>, Source <date>,
#   `Assigned On` <lgl>, Reference <chr>
~~~
{: .output}

Because we will need to reuse, let's make the list into an object


~~~
ribi_annotation <- read_tsv(ribi_annotation_file,comment="!")
~~~
{: .language-r}



~~~
Parsed with column specification:
cols(
  Gene = col_character(),
  `Gene Systematic Name` = col_character(),
  Qualifier = col_character(),
  `Gene Ontology Term ID` = col_character(),
  `Gene Ontology Term` = col_logical(),
  Aspect = col_character(),
  `Annotation Extension` = col_character(),
  Evidence = col_character(),
  Method = col_character(),
  Source = col_date(format = ""),
  `Assigned On` = col_logical(),
  Reference = col_character()
)
~~~
{: .output}

This statement doesn't produce any output because, as you might recall,
assignments don't display anything. If we want to check that our data has been
loaded, we can see the contents of the data frame by typing its name: `ribi_annotation`.


~~~
## Try also
View(ribi_annotation)
~~~
{: .language-r}

Now we have our data in R, we're going to learn how to inspect it, and some of the most common **`dplyr`** functions:

- `select()`: subset columns
- `n_distinct()` and `distinct()`: count or filter unique rows
- `filter()`: subset rows on conditions
- `mutate()`: create new columns by using information from other columns
- `group_by()` and `summarize()`: create summary statisitcs on grouped data
- `arrange()`: sort results
- `count()`: count discrete values



### Give nice names: 


~~~
ribi_annotation_names <- select(ribi_annotation,Gene,Name="Gene Systematic Name")
n_distinct(ribi_annotation_names)
~~~
{: .language-r}



~~~
[1] 187
~~~
{: .output}



~~~
ribi_genes <- distinct(ribi_annotation_names)
~~~
{: .language-r}


##  So which ribi genes are periodically expressed?


~~~
filter(ribi_genes, Name %in% periodic_list)
~~~
{: .language-r}



~~~
# A tibble: 34 x 2
   Gene  Name   
   <chr> <chr>  
 1 SPB1  YCL054W
 2 KRR1  YCL059C
 3 DBP10 YDL031W
 4 SAS10 YDL153C
 5 NOP6  YDL213C
 6 MAK21 YDR060W
 7 NOP16 YER002W
 8 NUG1  YER006W
 9 NSA2  YER126C
10 LCP5  YER127W
# ... with 24 more rows
~~~
{: .output}

Many of them.

## Getting nicer gene names

Gene names are in a nice format here:
https://datadryad.org/bitstream/handle/10255/dryad.85608


~~~
gene_name_file <- "https://datadryad.org/bitstream/handle/10255/dryad.85608/scer-mrna-protein-absolute-estimate.txt"

read_lines(gene_name_file,n_max=10)
~~~
{: .language-r}



~~~
 [1] "# SCM estimates of absolute mRNA and protein levels, scaled to (average) molecules per haploid cell, for haploid budding yeast (S.cerevisiae) growing exponentially in rich medium with glucose "
 [2] "#"                                                                                                                                                                                               
 [3] "# Generated Tue Apr 07 00:00:36 2015 "                                                                                                                                                           
 [4] "#"                                                                                                                                                                                               
 [5] "# Citation:"                                                                                                                                                                                     
 [6] "#   \"Accounting for experimental noise reveals that transcript levels,"                                                                                                                         
 [7] "#   amplified by post-transcriptional regulation, largely determine steady-state protein levels in yeast,\""                                                                                     
 [8] "#   Gábor Csárdi, Alexander Franks, David S. Choi, Eduardo M. Airoldi, and D. Allan Drummond, PLoS Genetics, 2015"                                                                               
 [9] "#"                                                                                                                                                                                               
[10] "# orf = Systematic yeast ORF (open reading frame) identifier"                                                                                                                                    
~~~
{: .output}


~~~
gene_names_big <- read_tsv(gene_name_file,comment="#")
~~~
{: .language-r}



~~~
Parsed with column specification:
cols(
  orf = col_character(),
  gene = col_character(),
  mrna = col_double(),
  prot = col_double(),
  sd.mrna = col_double(),
  sd.prot = col_double(),
  n.mrna = col_double(),
  n.prot = col_double()
)
~~~
{: .output}


~~~
gene_names <- select(gene_names_big,Gene=gene,Name=orf)
~~~
{: .language-r}


> ## Challenge: 
>
> 1. What are the names of the genes on the periodic list?
> 2. Is NOP56 on the list?
>
> > ## Solution
> >
> > 
> > ~~~
> > filter(gene_names,Name %in% periodic_list)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > # A tibble: 132 x 2
> >    Gene   Name   
> >    <chr>  <chr>  
> >  1 RPL19B YBL027W
> >  2 HEK2   YBL032W
> >  3 ARC40  YBR234C
> >  4 SPB1   YCL054W
> >  5 KRR1   YCL059C
> >  6 ELO2   YCR034W
> >  7 SSK22  YCR073C
> >  8 DBP10  YDL031W
> >  9 LHP1   YDL051W
> > 10 RPL13A YDL082W
> > # ... with 122 more rows
> > ~~~
> > {: .output}
> > 
> > 
> > 
> > ~~~
> > filter(gene_names,Name == "NOP56")
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > # A tibble: 0 x 2
> > # ... with 2 variables: Gene <chr>, Name <chr>
> > ~~~
> > {: .output}
> {: .solution}
{: .challenge}


{% include links.md %}
